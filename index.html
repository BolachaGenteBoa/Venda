<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Privado</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: #1e1e1e; padding: 30px; border-radius: 12px; width: 100%; max-width: 400px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 6px; border: 1px solid #333; background: #252525; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #007bff; border: none; color: white; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { background: #0056b3; }
        .hidden { display: none !important; }
        .error { color: #ff5555; font-size: 14px; margin-bottom: 10px; }
        .captcha { background: #2a2a2a; padding: 15px; border: 1px solid #444; border-radius: 8px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="login-screen" class="container">
        <h2>Acesso</h2>
        <div id="msg-erro" class="error"></div>

        <div id="captcha-box" class="hidden captcha">
            <p>Verificação: <span id="q1"></span> + <span id="q2"></span>?</p>
            <input type="number" id="ans">
            <button onclick="validarCap()">Confirmar</button>
        </div>

        <div id="form-login">
            <input type="number" id="code" placeholder="Código 1-9008">
            <button onclick="entrar()">Acessar</button>
        </div>

        <div id="ban-box" class="hidden">
            <p style="color:orange">ACESSO BLOQUEADO</p>
            <p>Tente novamente em: <span id="timer">15:00</span></p>
        </div>
    </div>

    <div id="feedback-screen" class="container hidden">
        <h2>Área de Feedback</h2>
        <p>Vendas Hoje: R$ 12.450,00</p>
        <textarea id="f-text" rows="4" placeholder="Sua análise..."></textarea>
        <button onclick="envFeedback()">Enviar para o Firebase</button>
        <button onclick="irLogin()" style="background:#555; margin-top:10px">Voltar</button>
    </div>

    <div id="vendas-screen" class="container hidden">
        <h1 style="color:#00ff88">Sucesso!</h1>
        <p>Você entrou no site de vendas.</p>
        <button onclick="location.reload()" style="background:#ff4444">Sair</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyATu9zkykXFpiTD2Mlh5Ee6qroDC1tefi8",
            authDomain: "ebooklandia-f041aa.firebaseapp.com",
            projectId: "ebooklandia-f041aa",
            storageBucket: "ebooklandia-f041aa.firebasestorage.app",
            messagingSenderId: "316525003872",
            appId: "1:316525003872:web:5327dac57baabdd3792f05",
            measurementId: "G-MWMF7NW7EH"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.envFeedback = async function() {
            const t = document.getElementById('f-text').value;
            if(t.length < 5) return alert("Feedback muito curto.");
            try {
                await addDoc(collection(db, "feedbacks"), { mensagem: t, data: serverTimestamp() });
                alert("Enviado ao Firebase!");
                document.getElementById('f-text').value = "";
            } catch(e) { alert("Erro no Firebase. Verifique se as regras do banco estão abertas."); }
        }
    </script>

    <script>
        let erros = 0, capOk = false, res = 0;
        
        function entrar() {
            if(isBanned()) return;
            if(erros >= 4 && !capOk) return showCap();

            const c = document.getElementById('code').value;
            // O código secreto está aqui de forma ofuscada (2000 * 3 + 767 = 6767)
            if(parseInt(c) === (2000 * 3 + 767)) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('vendas-screen').classList.remove('hidden');
            } else {
                erros++;
                document.getElementById('code').value = '';
                if(erros === 2) irFeedback();
                else if(erros === 4) showCap();
                else if(erros >= 5) banir();
                else document.getElementById('msg-erro').innerText = "Código incorreto ("+erros+"/5)";
            }
        }

        function showCap() {
            document.getElementById('form-login').classList.add('hidden');
            document.getElementById('captcha-box').classList.remove('hidden');
            const a = Math.floor(Math.random()*10), b = Math.floor(Math.random()*10);
            res = a + b;
            document.getElementById('q1').innerText = a;
            document.getElementById('q2').innerText = b;
        }

        function validarCap() {
            if(parseInt(document.getElementById('ans').value) === res) {
                capOk = true;
                document.getElementById('captcha-box').classList.add('hidden');
                document.getElementById('form-login').classList.remove('hidden');
                document.getElementById('msg-erro').innerText = "Captcha OK! Última tentativa.";
            } else { alert("Errado!"); showCap(); }
        }

        function irFeedback() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('feedback-screen').classList.remove('hidden');
        }

        function irLogin() {
            if(isBanned()) return alert("Banido.");
            document.getElementById('feedback-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
        }

        function banir() {
            localStorage.setItem('block_time', Date.now());
            document.getElementById('form-login').classList.add('hidden');
            document.getElementById('captcha-box').classList.add('hidden');
            document.getElementById('ban-box').classList.remove('hidden');
            let t = 900;
            const i = setInterval(() => {
                const m = Math.floor(t/60), s = t%60;
                document.getElementById('timer').innerText = m+":"+(s<10?'0':'')+s;
                if(--t < 0) { clearInterval(i); localStorage.removeItem('block_time'); location.reload(); }
            }, 1000);
            setTimeout(irFeedback, 2000);
        }

        function isBanned() {
            const b = localStorage.getItem('block_time');
            return b && (Date.now() - b < 900000);
        }

        if(isBanned()) banir();
    </script>
</body>
</html>
